Under review as a conference paper at ICLR 2019
MULTILINGUAL NEURAL MACHINE TRANSLATION WITH KNOWLEDGE DISTILLATION
Anonymous authors Paper under double-blind review
ABSTRACT
Multilingual machine translation, which translates multiple languages with a single model, has attracted much attention due to its efficiency of offline training and online serving. However, traditional multilingual translation usually yields inferior accuracy compared with the counterpart using individual models for each language pair, due to language diversity and model capacity limitations. In this paper, we propose a distillation-based approach to boost the accuracy of multilingual machine translation. Specifically, individual models are first trained and regarded as teachers, and then the multilingual model is trained to fit the training data and match the outputs of individual models simultaneously through knowledge distillation. Experiments on IWSLT, WMT and Ted talk translation datasets demonstrate the effectiveness of our method. Particularly, we show that one model is enough to handle multiple languages (up to 44 languages in our experiment), with comparable or even better accuracy than individual models.
1 INTRODUCTION
Neural Machine Translation (NMT) has witnessed rapid development in recent years (Bahdanau et al., 2015; Luong et al., 2015b; Wu et al., 2016; Gehring et al., 2017; Vaswani et al., 2017), including advanced model structures (Gehring et al., 2017; Vaswani et al., 2017) and human parity achievements (Hassan et al., 2018). While conventional NMT can well handle single pair translation, training a separate model for each language pair is resource consuming, considering there are thousands of languages in the world1. Therefore, multilingual NMT (Johnson et al., 2017; Firat et al., 2016; Ha et al., 2016; Lu et al., 2018) is developed which handles multiple language pairs in one model, greatly reducing the offline training and online serving cost.
Previous works on multilingual NMT mainly focus on model architecture design through parameter sharing, e.g., sharing encoder, decoder or attention module (Firat et al., 2016; Lu et al., 2018) or sharing the entire models (Johnson et al., 2017; Ha et al., 2016). They achieve comparable accuracy with individual models (each language pair with a separate model) when the languages are similar to each other and the number of language pairs is small (e.g., two or three). However, when handling more language pairs (dozens or even hundreds), the translation accuracy of multilingual model is usually inferior to individual models, due to language diversity.
It is challenging to train a multilingual translation model supporting dozens of language pairs while achieving comparable accuracy as individual models. Observing that individual models are usually of higher accuracy than the multilingual model in conventional model training, we propose to transfer the knowledge from individual models to the multilingual model with knowledge distillation, which has been studied for model compression and knowledge transfer and well matches our setting of multilingual translation. It usually starts by training a big/deep teacher model (or ensemble of multiple models), and then train a small/shallow student model to mimic the behaviors of the teacher model, such as its hidden representation (Yim et al., 2017; Romero et al., 2014), its output probabilities (Hinton et al., 2015; Freitag et al., 2017) or directly training on the sentences generated by the teacher model in neural machine translation (Kim & Rush, 2016). The student model can (nearly) match the accuracy of the cumbersome teacher model (or the ensemble of multiple models) with knowledge distillation.
1https://www.ethnologue.com/browse
1

Under review as a conference paper at ICLR 2019

In this paper, we propose a new method based on knowledge distillation for multilingual translation to eliminate the accuracy gap between the multilingual model and individual models. In our method, multiple individual models serve as teachers, each handling a separate language pair, while the student handles all the language pairs in a single model, which is different from the conventional knowledge distillation where the teacher and student models usually handle the same task. We first train the individual models for each translation pair and then we train the multilingual model by matching with the outputs of all the individual models and the ground-truth translation simultaneously. After some iterations of training, the multilingual model may get higher translation accuracy than the individual models on some language pairs. Then we remove the distillation loss and keep training the multilingual model on these languages pairs with the original log-likelihood loss of the ground-truth translation.
We conduct experiments on three translation datasets: IWSLT with 12 language pairs, WMT with 6 language pairs and Ted talk with 44 language pairs. Our proposed method boosts the translation accuracy of the baseline multilingual model and achieve similar (or even better) accuracy as individual models for most language pairs. Specifically, the multilingual model with only 1/44 parameters can match or surpass the accuracy of individual models on the Ted talk datasets.

2 BACKGROUND

2.1 NEURAL MACHINE TRANSLATION

Given a set of bilingual sentence pairs D = {(x, y)  X ×Y}, an NMT model learns the parameter 

by minimizing the negative log-likelihood - (x,y)D log P (y|x; ). P (y|x; ) is calculated based

on the chain rule

Ty t=1

P (yt|y<t, x;

),

where

y<t

represents

the

tokens

preceding

position

t,

and

Ty is the length of sentence y.

The encoder-decoder framework (Bahdanau et al., 2015; Luong et al., 2015b; Sutskever et al., 2014;
Wu et al., 2016; Gehring et al., 2017; Vaswani et al., 2017) is usually adopted to model the conditional probability P (y|x; ), where the encoder maps the input to a set of hidden representations h and the decoder generates each target token yt using the previous generated tokens y<t as well as the representations h.

2.2 MULTILINGUAL NMT
NMT has been extended from the translation of a single language pair to multilingual translation (Dong et al., 2015; Luong et al., 2015a; Firat et al., 2016; Lu et al., 2018; Johnson et al., 2017; Ha et al., 2016), considering the large amount of languages pairs in the world. Some of these works focus on how to share the components of the NMT model among multiple language pairs. Dong et al. (2015) use a shared encoder but different decoders to translate the same source language to multiple target languages. Luong et al. (2015a) use the combination of multiple encoders and decoders, with one encoder for each source language and one decoder for each target language respectively, to translate multiple source languages to multiple target languages. Firat et al. (2016) share the attention mechanism but use different encoders and decoders for multilingual translation. Similarly, Lu et al. (2018) design the neural interlingua, which is an attentional LSTM encoder to bridge multiple encoders and decoders for different language pairs. In Johnson et al. (2017) and Ha et al. (2016), multiple source and target languages are handled with a universal model (one encoder and decoder), with a special tag in the encoder to determine which target language to translate. In Gu et al. (2018a;b) and Neubig & Hu (2018), multilingual translation is leveraged to boost the accuracy of low-resource language pairs with better model structure or training mechanism.
It is observed that when there are dozens of language pairs, multilingual NMT usually achieves inferior accuracy compared with its counterpart which trains an individual model for each language pair. In this work we propose the multilingual distillation framework to boost the accuracy of multilingual NMT, so as to match or even surpass the accuracy of individual models.
2

Under review as a conference paper at ICLR 2019

2.3 KNOWLEDGE DISTILLATION
The early adoption of knowledge distillation is for model compression (Bucilu et al., 2006), where the goal is to deliver a compact student model that matches the accuracy of a large teacher model or the ensemble of multiple models. Knowledge distillation has soon been applied to a variety of tasks, including image classification (Hinton et al., 2015; Furlanello et al., 2018; Yang et al., 2018; Anil et al., 2018; Li et al., 2017), speech recognition (Hinton et al., 2015) and natural language processing (Kim & Rush, 2016; Freitag et al., 2017). Recent works (Furlanello et al., 2018; Yang et al., 2018) even demonstrate that student model can surpass the accuracy of the teacher model, even if the teacher model is of the same capacity as the student model. Zhang et al. (2017) propose the mutual learning to enable multiple student models to learn collaboratively and teach each other by knowledge distillation, which can improve the accuracy of those individual models. Anil et al. (2018) propose online distillation to improve the scalability of distributed model training and the training accuracy.
In this paper, we develop the multilingual distillation framework for multilingual NMT. Our work differs from Zhang et al. (2017) and Anil et al. (2018) in that they collaboratively train multiple student models with codistillation, while we use multiple teacher models to train a single student model, the multilingual NMT model.

3 METHOD

As aforementioned, when there are many language pairs and each pair has enough training data, the accuracy of individual models for those language pairs is usually higher than that of the multilingual model, given that the multilingual model has limited capacity comparing with the sum of all the individual models. Therefore, we propose to teach the multilingual model using the individual models as teachers. Here we first describe the idea of knowledge distillation in neural machine translation for the case of one teacher and one student, and then introduce our method in the multilingual setting with multiple teachers (the individual models) and one student (the multilingual model).

3.1 ONE TEACHER AND ONE STUDENT

Denote D = {(x, y)  X × Y} as the bilingual corpus of a language pair. The log-likelihood loss

(cross-entropy with one-hot label) on corpus D with regard to an NMT model  can be formulated

as follows:

LNLL(D; ) = -

log P (y|x; ),

(x,y)D

Ty |V |

log P (y|x; ) =

1{yt = k} log P (yt = k|y<t, x; ),

(1)

t=1 k=1

where Ty is the length of the target sentence, |V | is the vocabulary size of the target language, yt is
the t-th target token, 1{·} is the indicator function that represents the one-hot label, and P (·|·) is the

conditional probability with model .

In knowledge distillation, the student (with model parameter ) not only matches the outputs of the
ground-truth one-hot label, but also to the probability outputs of the teacher model (with parameter T ). Denote the output distribution of the teacher model for token yt as Q(yt|y<t, x; T ). The cross entropy between two distributions is served as the distillation loss:

Ty |V |

LKD(D; , T ) = -

Q{yt = k|y<t, x; T } log P (yt = k|y<t, x; ).

(x,y)D t=1 k=1

(2)

The difference between LNLL(D; ) and LKD(D; , T ) is that the target distribution of LKD(D; , T ) is no longer the original one-hot label, but teacher's output distribution which is more smooth by assigning non-zero probabilities to more than one word and yields smaller variance
in gradients (Hinton et al., 2015). Then the total loss function becomes

LALL(D; , T ) = (1 - )LNLL(D; ) + LKD(D; , T ),

(3)

where  is the coefficient to trade off the two loss terms.

3

Under review as a conference paper at ICLR 2019
3.2 MULTILINGUAL DISTILLATION WITH MULTIPLE TEACHERS AND ONE STUDENT
Let L denote the total number of language pairs in our setting, superscript l  [L] denote the index of language pair, Dl denote the bilingual corpus for the l-th language pair, M denote the parameters of the (student) multilingual model, and Il denote the parameters of the (teacher) individual model for l-th language pair. Therefore, LNLL(D; M ) denotes the log-likelihood loss on training data D, and LALL(D; M , Il ) denotes the total loss on training data D, which consists of the original log-likelihood loss and the distillation loss by matching to the outputs from the teacher model Il .
The multilingual distillation process is summarized in Algorithm 1. As can be seen in Line 1, our algorithm takes pretrained individual models for each language pair as inputs. Note that those models can be pretrained using the same datasets {Dl}Ll=1 or different datasets, and they can share the same network structure as the multilingual model or use different architectures. For simplification, in our experiments, we use the same datasets to pretrain the individual models and they share the same architecture as the multilingual model. In Line 8-9, the multilingual model learns from both the ground-truth data and the individual models with loss LALL when its accuracy has not surpassed the individual model for a certain threshold  (which is checked in Line 15-19 every Tcheck steps according to the accuracy in validation set); otherwise, the multilingual model only learns from the ground-truth data using the original log-likelihood loss LNLL (in Line 10-11).
Algorithm 1 Knowledge Distillation for Multilingual NMT
1: Input: Training corpus {Dl}Ll=1 and pretrained individual models {Il }lL=1 for L language pairs, learning rate , total training steps T , distillation check step Tcheck, threshold  of distillation accuracy.
2: Initialize: Randomly initialize multilingual model M . Set current training step T = 0, accumulated gradient g = 0, distillation flag f l = True for l  [L].
3: while T < T do 4: T = T +1 5: g = 0 6: for l  [L] do 7: Randomly sample a mini-batch of sentence pairs (xl, yl) from Dl. 8: if f l == True do 9: Compute and accumulate the gradient on loss LALL((xl, yl); M , Il ): g += LALL/M . 10: else 11: Compute and accumulate the gradient on loss LNLL((xl, yl); M ): g += LNLL/M . 12: end if 13: end for 14: Update M : M = M -   g 15: if T % Tcheck == 0 do 16: for l  [L] do 17: if Accuracy(M ) < Accuracy(Il ) +  do f l = True else f l = False end if 18: end for 19: end if 20: end while
3.3 DISCUSSION
Early Stopping in Distillation Considering that distillation from a bad teacher model is likely to hurt the student model and thus result in inferior accuracy, we use early stopping in the distillation process, as shown in Line 15-19 in Algorithm 1. When the accuracy of multilingual model surpasses the individual model for the accuracy threshold  on a certain language pair, we stop the distillation process and just train the model with original negative log-likelihood loss for this pair. We also verify the effectiveness of this early stopping in experiment part (Section 4.3).
Top-K Distillation It is burdensome to load all the teacher models in the GPU memory for distillation considering there are dozens or even hundreds of language pairs in the multilingual setting. Alternatively, we first generate the output probability distribution of each teacher model for the sentence pairs offline, and then just load the top-K probabilities of the distribution into memory for
4

Under review as a conference paper at ICLR 2019
distillation. This can reduce the memory cost again from the scale of |V | (the vocabulary size) to K. We also study in Section 4.3 that top-K distribution can result in comparable or better distillation accuracy than the full distribution.
4 EXPERIMENTS
We test our proposed method on three public datasets: IWSLT, WMT, and Ted talk translation tasks. We first describe experimental settings, report results, and conduct some analyses on our method.
4.1 SETTINGS
Datasets We use three datasets in our experiment. IWSLT: We collect 12 languagesEnglish translation pairs from IWSLT evaluation campaign2 from year 2014 to 2016. WMT: We collect 6 languagesEnglish translation pairs from WMT translation task3. Ted Talk: We use the common corpus of TED talk which contains translations between multiple languages (Ye et al., 2018). We select 44 languages in this corpus that has sufficient data for our experiments. More descriptions about the three datasets can be found in Appendix (Section 1). We also list the language code according to ISO-639-1 standard4 for the languages used in our experiments in Appendix (Section 2). All the sentences are first tokenized with moses tokenizer5 and then segmented into subword symbols using Byte Pair Encoding (BPE) (Sennrich et al., 2016). We learn the BPE merge operations across all the languages and keep the output vocabulary of the teacher and student model the same, to ensure knowledge distillation.
Model Configurations We use the Transformer (Vaswani et al., 2017) as the basic NMT model structure since it achieves state-of-the-art accuracy and becomes a popular choice for recent NMT researches. We use the same model configuration for individual models and the multilingual model. For IWSLT and Ted talk tasks, the model hidden size dmodel, feed-forward hidden size dff, number of layer are 256, 1024 and 2, while for WMT task, the three parameters are 512, 2048 and 6 respectively considering its large scale of training data.
Training and Inference For the multilingual model training, we up sample the data of each language to make all languages have the same size of data. The mini batch size is set to roughly 8192 tokens. We train the individual models with 4 NVIDIA Tesla V100 GPU cards and multilingual models with 8 of them. We follow the default parameters of Adam optimizer (Kingma & Ba, 2014) and learning rate schedule in Vaswani et al. (2017). For the individual models, we use 0.2 dropout, while for multilingual models, we use 0.1 dropout according to the validation performance. For knowledge distillation, we set Tcheck = 3000 steps (nearly two training epochs), the accuracy threshold  = 1 BLEU score, the distillation coefficient  = 0.5 and the number of teacher's outputs K = 8 according to the validation performance. During inference, we decode with beam search and set beam size to 4 and length penalty  = 1.0 for all the languages. We evaluate the translation quality by tokenized case sensitive BLEU (Papineni et al., 2002) with multi-bleu.pl6. Our codes are implemented based on fairseq7 and we will release the codes once the paper is published.
4.2 RESULTS
Results on IWSLT The results of 12 languagesEnglish translations on the IWLST dataset are shown in Table 1. There are 3 methods for comparison: 1) Individual, each language pair with a separate model; 2) Multi-Baseline, the baseline multilingual model, simply training all the language pairs in one model; 3) Multi-Distillation, our multilingual model with knowledge distillation. We have several observations. First, the multilingual baseline performs worse than individual models on most languages. The only exception is the languages with small training data, which benefit
2https://wit3.fbk.eu/ 3http://www.statmt.org/wmt16/translation-task.html, http://www.statmt.org/wmt17/translation-task.html 4https://www.loc.gov/standards/iso639-2/php/code list.php 5https://github.com/moses-smt/mosesdecoder/blob/master/scripts/tokenizer/tokenizer.perl 6https://github.com/moses-smt/mosesdecoder/blob/master/scripts/generic/multi-bleu.perl 7https://github.com/pytorch/fairseq
5

Under review as a conference paper at ICLR 2019

from data augmentation in multilingual training. Second, our method outperforms the multilingual baseline for all the languages, demonstrating the effectiveness of our framework for multilingual NMT. More importantly, compared with the individual models, our method achieves similar or even better accuracy (better on 10 out of 12 languages), with only 1/12 model parameters of the sum of all individual models.

Language
Ar Cs De He Nl Pt Ro Ru Th Tr Vi Zh

Individual
31.19 28.04 33.07 37.42 35.94 44.30 36.92 23.04 18.24 22.74 26.06 19.44

Multi-Baseline
29.24 (-1.95) 26.09 (-1.95) 32.74 (-0.33) 35.18 (-2.24) 36.54 (+0.60) 43.49 (-0.81) 36.41 (-0.51) 23.12 (+0.08) 19.33 (+1.09) 22.42 (-0.32) 26.37 (+0.31) 18.82 (-0.62)

Multi-Distillation
31.25 (+0.06) 27.09 (-0.95) 34.02 (+0.95) 37.33 (-0.09) 37.69 (+1.75) 44.69 (+0.39) 38.01 (+1.09) 23.76 (+0.72) 19.90 (+1.66) 23.75 (+1.01) 27.04 (+0.98) 19.52 (+0.08)


+2.01 +1.00 +1.28 +2.15 +1.15 +1.20 +1.60 +0.64 +0.57 +1.33 +0.67 +0.70

Table 1: BLEU scores of 12 languagesEnglish on the IWLST dataset. The BLEU scores in () represent the difference between the multilingual model and individual models.  represents the improvements of our multi-distillation method over the multi-baseline.

Results on WMT The results of 6 languagesEnglish translations on the WMT dataset are reported in Table 2. It can be seen that the multi-baseline model performs worse than the individual models on 5 out of 6 languages, while in contrast, our method performs better on all the 6 languages. Particularly, our method improves the accuracy of some languages with more than 2 BLEU scores over individual models.

Language
Cs De Fi Lv Ro Ru

Individual
25.29 34.44 21.23 16.26 35.81 29.39

Multi-Baseline
23.82 (-1.47) 34.21 (-0.23) 22.99 (+1.76) 16.25 (-0.01) 35.04 (-0.77) 28.92 (-0.47)

Multi-Distillation
25.37 (+0.08) 36.22 (+1.78) 24.32 (+3.09) 18.43 (+2.17) 36.51 (+0.70) 30.82 (+1.43)


+1.55 +2.01 +1.33 +2.18 +1.47 +1.90

Table 2: BLEU scores of 6 languagesEnglish on the WMT dataset. The BLEU scores in () represent the difference between the multilingual model and individual models.  represents the improvements of our multi-distillation method over the multi-baseline.

Results on Ted Talk Now we study the effectiveness of our method on a large number of languages. The experiments are conducted on the 44 languagesEnglish on the Ted talk dataset. Due to the large number of languages and space limitations, we just show the BLEU score improvements of our method over individual models and the multi-baseline for each language in Table 3, and leave the detailed experiment results to Appendix (Section 3). It can be seen that our method can improve over the multi-baseline for all the languages, mostly with more than 1 BLEU score improvements. Our method can also match or even surpass individual models for most languages, not to mention that the number of parameters of our method is only 1/44 of that of the sum of 44 individual models.
4.3 ANALYSIS
In this section, we conduct thorough analyses on our proposed method for multilingual NMT.
Early Stopping in Distillation We study the effectiveness of the early stopping (discussed in Section 3.3) for the multilingual distillation on the Ted talk dataset, as shown in Table 4. We list the
6

Under review as a conference paper at ICLR 2019

Language
1 2 Language
1 2 Language
1 2 Language
1 2

Ar
-1.50 1.73 Fr
0.13 1.48 Ko
-0.42 1.43 Ru
0.65 0.99

Bg
-9.46 1.42 Gl
19.26 1.58 Ku
7.75 1.55 Sk
4.23 0.93

Cs
1.88 1.13 He
-1.59 2.26 Lt
4.46 1.69 Sl
11.87 1.15

Da
4.02 1.82 Hi
10.16 1.07 Mk
10.72 0.80 Sq
5.03 1.68

De
-0.10 1.68 Hr
1.46 1.21 My
7.63 1.31 Sr
1.58 1.44

El
0.80 1.45 Hu
-0.11 1.80 Nb
14.07 1.47 Sv
2.39 1.00

Es
0.23 1.63 Hy
8.87 0.92 Nl
-0.20 1.68 Th
1.17 0.62

Et
8.20 0.77 Id
1.36 1.48 Pl
1.32 0.80 Tr
-0.79 1.88

Fa
0.09 1.83
It
-0.56 1.48 Ptbr
0.13 1.45 Uk
2.04 0.98

Fi
6.44 1.10 Ja
-0.03 0.95 Pt
8.76 1.98 Vi
0.15 0.77

Frca
15.8 1.24 Ka
11.20 1.55 Ro
0.66 1.70 Zh
6.83 0.58

Table 3: BLEU scores improvements of our method over the individual models (1) and multibaseline model (2) on the 44 languagesEnglish in the Ted talk dataset.

16 languages on which the two methods (with or without early stopping) have difference bigger than 0.5 in terms of BLEU score. It can be seen that distillation with early stopping performs better on 13 out of 16 languages, with large BLEU score improvements, which demonstrates the effectiveness of the early stopping in distillation.

without early stopping with early stopping 
without early stopping with early stopping 

Bg
28.07 29.18
+1.11 Ku
8.50 13.38
+4.88

Et
12.64 15.63
+2.99 Mk
32.10 32.65
+0.55

Fi
15.13 17.23
+2.10 My
14.02 15.17
+1.15

Fr
33.69 34.32
+0.63 Sl
22.10 23.68
+1.58

Gl
30.28 31.90
+1.62 Zh
17.22 19.39
+2.17

Hi
18.86 21.00
+2.14 Pl
25.05 24.30
-0.75

Hy
19.88 21.17
+1.29 Sk
30.45 29.91
-0.54

Ka
14.04 18.27
+4.23 Sv
37.88 36.92
-0.96

Table 4: BLEU scores of our method with and without early stopping during the distillation process on the Ted talk dataset.

Top-K Distillation In our experiments, the student model just matches the top-K output distribution of the teacher model, instead of the full distribution, in order to reduce the memory cost. We analyze whether there is accuracy difference between the top-K distribution and the full distribution. We conduct experiments on IWSLT dataset with varying K (from 1 to |V |, where |V | is the vocabulary size), and just show the BLEU scores on the validation set of De-En translation due to space limitation, as illustrated in Table 5. It can be seen that increasing K from 1 to 8 will improve the accuracy, while bigger K will bring no gains, even with the full distribution (K = |V |).
Top-K 1 2 4 8 16 32 64 128 |V |
BLEU 33.45 33.86 34.47 34.76 34.66 34.68 34.54 34.47 34.49
Table 5: BLEU scores on De-En translation with varying Top-K distillation on the IWSLT dataset.

Back Distillation In our current distillation algorithm, we fix the individual models and use them to teach and improve the multilingual model. After such a distillation process, the multilingual model outperforms the individual models on most of the languages. Then naturally, we may wonder whether this improved multilingual model can further be used to teach and improve individual models through knowledge distillation. We call such a process back distillation. We conduct the experiments on the IWSLT dataset, and find that the accuracy of 9 out of 12 languages gets im-
7

Under review as a conference paper at ICLR 2019

proved, as shown in Table 6. The other 3 languages (He, Pt, Zh) cannot get improvements because the improved multilingual model performs very close to individual models, as shown in Table 1.

Language
Individual +Back Distillation


Ar
31.19 31.39
+0.20

Cs
28.04 29.44
+1.40

De
33.07 33.71
+0.64

Nl
35.94 36.86
+0.92

Ro
36.92 37.28
+0.36

Ru
23.04 23.36
+0.32

Th
18.24 19.42
+1.18

Tr
22.74 23.58
+0.84

Vi
26.06 27.17
+1.11

Table 6: BLEU score improvements of the individual models with back distillation on the IWSLT dataset.

Generalization Analysis Previous works (Yang et al., 2018; Lan et al., 2018) have shown that knowledge distillation can help a model generalize well to unseen data, and thus yield better performance. We analyze how distillation in multilingual setting helps the model generalization. Previous studies (Keskar et al., 2016; Chaudhari et al., 2016) demonstrate the relationship between model generalization and the width of local minima in loss surface. Wider local minima can make the model more robust to small perturbations in testing. Therefore, we compare the generalization capability of the two multilingual models (our method and the baseline) by perturbing their parameters.
Specifically, we perturb a model  as i() = i + ¯  N (0, 2), where i is the i-th parameter of the model, ¯ is the average of all the parameters in , N is the normal distribution,  is the standard variance and larger  represents bigger perturbation. We conduct the analyses on the IWSLT dataset and vary   [0.05, 0.1, 0.15, 0.2, 0.25, 0.3]. Figure 1a shows the loss curve in the test set with varying . As can be seen, while both the two losses increase with the increase of , the loss of the baseline model increases quicker than our method. We also show three test BLEU curves on three translation pairs (Figure 1b: Ar-En, Figure 1c: Cs-En, Figure 1d: De-En, which are randomly picked from the 12 languages pairs on the IWSLT dataset). We observe that the BLEU score of the multilingual baseline drops quicker than our method, which demonstrates that our method helps the model find wider local minima and thus generalize better.

(a) (b) (c) (d)
Figure 1: The loss (Figure a) and BLEU score (Figure b: Ar-En, Figure c: Cs-En, Figure d: De-En) changes on the test set of the IWSLT dataset, with varying perturbation parameter .
5 CONCLUSION
In this work, we have proposed a distillation-based approach to boost the accuracy of multilingual NMT, which is usually of lower accuracy than the individual models in previous works. Experiments on three translation datasets with up to 44 languages demonstrate the multilingual model based on our proposed method can nearly match or even outperform the individual models, with just 1/N model parameters (N is up to 44 in our experiments). In the future, we will conduct more deep analyses about how distillation helps the multilingual model training. We will apply our method to larger datasets and more languages pairs (hundreds or even thousands), to study the upper limit of our proposed method.
8

Under review as a conference paper at ICLR 2019
REFERENCES
Rohan Anil, Gabriel Pereyra, Alexandre Passos, Robert Ormandi, George E Dahl, and Geoffrey E Hinton. Large scale distributed neural network training through online distillation. arXiv preprint arXiv:1804.03235, 2018.
Dzmitry Bahdanau, Kyunghyun Cho, and Yoshua Bengio. Neural machine translation by jointly learning to align and translate. ICLR 2015, 2015.
Cristian Bucilu, Rich Caruana, and Alexandru Niculescu-Mizil. Model compression. In Proceedings of the 12th ACM SIGKDD international conference on Knowledge discovery and data mining, pp. 535­541. ACM, 2006.
Pratik Chaudhari, Anna Choromanska, Stefano Soatto, Yann LeCun, Carlo Baldassi, Christian Borgs, Jennifer Chayes, Levent Sagun, and Riccardo Zecchina. Entropy-sgd: Biasing gradient descent into wide valleys. arXiv preprint arXiv:1611.01838, 2016.
Daxiang Dong, Hua Wu, Wei He, Dianhai Yu, and Haifeng Wang. Multi-task learning for multiple language translation. In Proceedings of the 53rd Annual Meeting of the Association for Computational Linguistics and the 7th International Joint Conference on Natural Language Processing (Volume 1: Long Papers), volume 1, pp. 1723­1732, 2015.
Orhan Firat, Kyunghyun Cho, and Yoshua Bengio. Multi-way, multilingual neural machine translation with a shared attention mechanism. In NAACL HLT 2016, The 2016 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, San Diego California, USA, June 12-17, 2016, pp. 866­875, 2016.
Markus Freitag, Yaser Al-Onaizan, and Baskaran Sankaran. Ensemble distillation for neural machine translation. arXiv preprint arXiv:1702.01802, 2017.
Tommaso Furlanello, Zachary C Lipton, Michael Tschannen, Laurent Itti, and Anima Anandkumar. Born again neural networks. arXiv preprint arXiv:1805.04770, 2018.
Jonas Gehring, Michael Auli, David Grangier, Denis Yarats, and Yann N. Dauphin. Convolutional sequence to sequence learning. In Proceedings of the 34th International Conference on Machine Learning, ICML 2017, Sydney, NSW, Australia, 6-11 August 2017, pp. 1243­1252, 2017.
Jiatao Gu, Hany Hassan, Jacob Devlin, and Victor O. K. Li. Universal neural machine translation for extremely low resource languages. In NAACL-HLT 2018, New Orleans, Louisiana, USA, June 1-6, 2018, Volume 1 (Long Papers), pp. 344­354, 2018a.
Jiatao Gu, Yong Wang, Yun Chen, Kyunghyun Cho, and Victor OK Li. Meta-learning for lowresource neural machine translation. arXiv preprint arXiv:1808.08437, 2018b.
Thanh-Le Ha, Jan Niehues, and Alexander H. Waibel. Toward multilingual neural machine translation with universal encoder and decoder. CoRR, abs/1611.04798, 2016. URL http: //arxiv.org/abs/1611.04798.
Hany Hassan, Anthony Aue, Chang Chen, Vishal Chowdhary, Jonathan Clark, Christian Federmann, Xuedong Huang, Marcin Junczys-Dowmunt, William Lewis, Mu Li, Shujie Liu, Tie-Yan Liu, Renqian Luo, Arul Menezes, Tao Qin, Frank Seide, Xu Tan, Fei Tian, Lijun Wu, Shuangzhi Wu, Yingce Xia, Dongdong Zhang, Zhirui Zhang, and Ming Zhou. Achieving human parity on automatic chinese to english news translation. CoRR, abs/1803.05567, 2018. URL http: //arxiv.org/abs/1803.05567.
Geoffrey Hinton, Oriol Vinyals, and Jeff Dean. Distilling the knowledge in a neural network. arXiv preprint arXiv:1503.02531, 2015.
Melvin Johnson, Mike Schuster, Quoc V. Le, Maxim Krikun, Yonghui Wu, Zhifeng Chen, Nikhil Thorat, Fernanda B. Vie´gas, Martin Wattenberg, Greg Corrado, Macduff Hughes, and Jeffrey Dean. Google's multilingual neural machine translation system: Enabling zero-shot translation. TACL, 5:339­351, 2017. URL https://transacl.org/ojs/index.php/tacl/ article/view/1081.
9

Under review as a conference paper at ICLR 2019
Nitish Shirish Keskar, Dheevatsa Mudigere, Jorge Nocedal, Mikhail Smelyanskiy, and Ping Tak Peter Tang. On large-batch training for deep learning: Generalization gap and sharp minima. arXiv preprint arXiv:1609.04836, 2016.
Yoon Kim and Alexander M. Rush. Sequence-level knowledge distillation. In Proceedings of the 2016 Conference on Empirical Methods in Natural Language Processing, EMNLP 2016, Austin, Texas, USA, November 1-4, 2016, pp. 1317­1327, 2016.
Diederik Kingma and Jimmy Ba. Adam: A method for stochastic optimization. arXiv preprint arXiv:1412.6980, 2014.
Xu Lan, Xiatian Zhu, and Shaogang Gong. Knowledge distillation by on-the-fly native ensemble. arXiv preprint arXiv:1806.04606, 2018.
Yuncheng Li, Jianchao Yang, Yale Song, Liangliang Cao, Jiebo Luo, and Li-Jia Li. Learning from noisy labels with distillation. In ICCV, pp. 1928­1936, 2017.
Yichao Lu, Phillip Keung, Faisal Ladhak, Vikas Bhardwaj, Shaonan Zhang, and Jason Sun. A neural interlingua for multilingual machine translation. CoRR, abs/1804.08198, 2018. URL http://arxiv.org/abs/1804.08198.
Minh-Thang Luong, Quoc V. Le, Ilya Sutskever, Oriol Vinyals, and Lukasz Kaiser. Multi-task sequence to sequence learning. CoRR, abs/1511.06114, 2015a. URL http://arxiv.org/ abs/1511.06114.
Thang Luong, Hieu Pham, and Christopher D. Manning. Effective approaches to attention-based neural machine translation. In Proceedings of the 2015 Conference on Empirical Methods in Natural Language Processing, EMNLP 2015, Lisbon, Portugal, September 17-21, 2015, pp. 1412­ 1421, 2015b.
Graham Neubig and Junjie Hu. Rapid adaptation of neural machine translation to new languages. arXiv preprint arXiv:1808.04189, 2018.
Kishore Papineni, Salim Roukos, Todd Ward, and Wei-Jing Zhu. Bleu: a method for automatic evaluation of machine translation. In Proceedings of the 40th Annual Meeting of the Association for Computational Linguistics, July 6-12, 2002, Philadelphia, PA, USA., pp. 311­318, 2002. URL http://www.aclweb.org/anthology/P02-1040.pdf.
Adriana Romero, Nicolas Ballas, Samira Ebrahimi Kahou, Antoine Chassang, Carlo Gatta, and Yoshua Bengio. Fitnets: Hints for thin deep nets. arXiv preprint arXiv:1412.6550, 2014.
Rico Sennrich, Barry Haddow, and Alexandra Birch. Neural machine translation of rare words with subword units. In ACL 2016, August 7-12, 2016, Berlin, Germany, Volume 1: Long Papers, 2016. URL http://aclweb.org/anthology/P/P16/P16-1162.pdf.
Ilya Sutskever, Oriol Vinyals, and Quoc V. Le. Sequence to sequence learning with neural networks. In NIPS 2014, December 8-13 2014, Montreal, Quebec, Canada, pp. 3104­3112, 2014.
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N. Gomez, Lukasz Kaiser, and Illia Polosukhin. Attention is all you need. In NIPS 2017, 4-9 December 2017, Long Beach, CA, USA, pp. 6000­6010, 2017.
Yonghui Wu, Mike Schuster, Zhifeng Chen, Quoc V. Le, Mohammad Norouzi, Wolfgang Macherey, Maxim Krikun, Yuan Cao, Qin Gao, Klaus Macherey, Jeff Klingner, Apurva Shah, Melvin Johnson, Xiaobing Liu, Lukasz Kaiser, Stephan Gouws, Yoshikiyo Kato, Taku Kudo, Hideto Kazawa, Keith Stevens, George Kurian, Nishant Patil, Wei Wang, Cliff Young, Jason Smith, Jason Riesa, Alex Rudnick, Oriol Vinyals, Greg Corrado, Macduff Hughes, and Jeffrey Dean. Google's neural machine translation system: Bridging the gap between human and machine translation. CoRR, abs/1609.08144, 2016. URL http://arxiv.org/abs/1609.08144.
Chenglin Yang, Lingxi Xie, Siyuan Qiao, and Alan Yuille. Knowledge distillation in generations: More tolerant teachers educate better students. arXiv preprint arXiv:1805.05551, 2018.
10

Under review as a conference paper at ICLR 2019 Qi Ye, Sachan Devendra, Felix Matthieu, Padmanabhan Sarguna, and Neubig Graham. When and
why are pre-trained word embeddings useful for neural machine translation. In HLT-NAACL, 2018. Junho Yim, Donggyu Joo, Jihoon Bae, and Junmo Kim. A gift from knowledge distillation: Fast optimization, network minimization and transfer learning. In The IEEE Conference on Computer Vision and Pattern Recognition (CVPR), volume 2, 2017. Ying Zhang, Tao Xiang, Timothy M Hospedales, and Huchuan Lu. Deep mutual learning. arXiv preprint arXiv:1706.00384, 6, 2017.
11

Under review as a conference paper at ICLR 2019

APPENDIX

1 DATASET DESCRIPTION

We give a detailed description about the IWSLT,WMT and Ted Talk datasets used in experiments.
IWSLT: We collect 12 languagesEnglish translation pairs from IWSLT evaluation campaign8 from year 2014 to 2016. Each language pair contains roughly 80K to 200K sentence pairs. We use the official validation and test sets for each language pair. The data sizes of the training set for each languageEnglish pair are listed in Table 7.

Language Training Data
Language Training Data

Ar 174K
Ro 177K

Cs 114K
Ru 173K

De 167K
Th 83K

He 180K
Tr 150K

Nl 174K
Vi 131K

Pt 167K
Zh 209K

Table 7: The training data size on the 12 languages English on the IWSLT dataset.

WMT: We collect 6 languagesEnglish translation pairs from WMT translation task9. We use 5 languageEnglish translation pairs from WMT 2016 dataset: Cs-En, De-En, Fi-En, Ro-En, Ru-
En and one other translation pair from WMT 2017 dataset: Lv-En. We use the official released validation and test sets for each language pair. The training data sizes of each languageEnglish
pair are shown in the Table 8.

Language

Cs De Fi Lv Ro Ru

Training Data 4.5M 1.0M 2.5M 4.5M 2.2M 2.1M

Table 8: The training data size on the 6 languagesEnglish on the WMT dataset.

Ted Talk: We use the common corpus of TED talk which contains translations between multiple languages (Ye et al., 2018)10. We select 44 languages in this corpus that has sufficient data for our
experiments. We use the official validation and test sets for each language pair. The data sizes of the training set for each languageEnglish pair are listed in Table 9.

Language Ar Bg Cs Da De El Es Et Fa Fi Frca

Training Data 214K 174k 103k 45k 168k 134k 196k 11k 151k 24k Language Fr Gl He Hi Hr Hu Hy Id It Ja

20k Ka

Training Data 192K 10K 212K 19K 122K 147K 21K 87K 205K 204K 13K

Language

Ko Ku Lt Mk My Nb Nl

Pl Ptbr Pt

Ro

Training Data 206K 10K 42K 25K 21K 16K 184K 176K 185K 52K 180K Language Ru Sk Sl Sq Sr Sv Th Tr Uk Vi Zh

Training Data 208K 61K 20K 45K 137K 57K 98K 182K 108K 172K 200K

Table 9: The training data size on the 44 languages English on the Ted talk dataset.

2 LANGUAGE NAME AND CODE
The language names and their corresponding language codes according to ISO 639-1 standard11 are listed in Table 10.
8https://wit3.fbk.eu/ 9http://www.statmt.org/wmt16/translation-task.html, http://www.statmt.org/wmt17/translation-task.html 10https://github.com/neulab/word-embeddings-for-nmt 11https://www.loc.gov/standards/iso639-2/php/code list.php
12

Under review as a conference paper at ICLR 2019

Language
Arabic German Persian Hebrew Armenian Georgian Latvian
Dutch Russian Serbian Ukrainian

Code
Ar De Fa He Hy Ka Lv Nl Ru Sr Uk

Language
Bulgarian Greek
Finnish Hindi
Indonesian Korean
Macedonian Polish Slovak
Swedish Vietnamese

Code
Bg El Fi Hi Id Ko Mk Pl Sk Sv Vi

Language
Czech English French Croatian
Italian Kurdish Burmese Portuguese Slovenian
Thai Chinese

Code
Cs En Fr Hr It Ku My Pt Sl Th Zh

Language
Danish Spanish Galician Hungarian Japanese Lithuanian Norwegian Romanian Albanian Turkish

Code
Da Es Gl Hu Ja Lt Nb Ro Sq Tr

Table 10: The ISO 639-1 code of each language in our experiments. There are two extra language codes in our datasets: Ptbr represents Portuguese spoken in Brazil, Frca represents French spoken in Canada.

3 RESULTS ON TED TALK DATASET
The detailed results of the 44 languagesEnglish on the Ted talk dataset are listed in Table 11. It can be seen that while multilingual baseline performs worse than the individual model, multilingual model based on our method nearly matches and even outperforms the individual model. Note that the multilingual model handles 44 languages in total, which means our method can reduce the model parameters size to 1/44 without loss of accuracy.

Language Individual Multilingual (Baseline)
Multilingual (Our method)
Language Individual Multilingual (Baseline)
Multilingual (Our method)
Language Individual Multilingual (Baseline)
Multilingual (Our method)
Language Individual Multilingual (Baseline)
Multilingual (Our method)
Language Individual Multilingual (Baseline)
Multilingual (Our method)

Ar
31.07 27.84
29.57
Fi
10.78 16.12
17.22
Id
29.20 29.08
30.56
Nb
27.28 39.88
41.35
Sq
29.70 33.05
34.73

Bg
38.64 27.76
29.18
Frca
18.52 33.08
34.32
It
38.06 36.02
37.50
Nl
35.85 33.97
35.65
Sr
32.13 32.27
33.71

Cs
26.42 27.17
28.30
Fr
39.62 38.27
39.75
Ja
13.31 12.33
13.28
Pl
22.98 23.50
24.30
Sv
34.53 35.92
36.92

Da
38.21 40.41
42.23
Gl
12.64 30.32
31.9
Ka
7.06 16.71
18.26
Ptbr
44.28 42.96
44.41
Th
20.95 21.50
22.12

De
34.63 32.85
34.53
He
36.81 32.96
35.22
Ko
18.54 16.71
18.14
Pt
33.81 40.59
42.57
Tr
24.46 21.79
23.67

El
36.69 36.04
37.49
Hi
10.84 19.93
21.00
Ku
5.63 11.83
13.38
Ro
34.07 33.03
34.73
Uk
25.76 26.82
27.80

Es
41.20 39.80
41.43
Hr
34.14 34.39
35.6
Lt
18.19 20.96
22.65
Ru
24.36 24.02
25.01
Vi
26.38 25.76
26.53

Et
7.43 14.86
15.63
Hu
24.67 22.76
24.56
Mk
21.93 31.85
32.65
Sk
25.67 28.97
29.90
Zh
12.56 18.81
19.39

Fa
26.67 24.93
26.76
Hy
12.30 20.25
21.17
My
7.53 13.85
15.16
Sl
11.80 22.52
23.67

Table 11: BLEU scores of the individual and multilingual models on the 44 languagesEnglish on the Ted talk dataset.

13

